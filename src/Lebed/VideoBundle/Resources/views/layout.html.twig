{% extends "::base.html.twig" %}

    {% block title %}Geekhub Advanced PHP{% endblock %}

    {% block stylesheets %}
        <link href="{{ asset('css/bootstrap.min.css') }}" rel="stylesheet" type="text/css">
        <link href="{{ asset('css/blog.css') }}" rel="stylesheet" type="text/css">
        <link href="{{ asset('bundles/lebedvideo/css/style.css') }}" rel="stylesheet">
        <link rel="stylesheet" type="text/css" charset="UTF-8" href="/js/fancybox/jquery.fancybox.css"/>
    {% endblock %}

    {% block jsHead %}
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script type="text/javascript" src="{{ asset('js/bootstrap.ie9.js') }}"></script>
        <![endif]-->
    {% endblock %}

    {% block body %}

        {% block menu %}
            {% include 'LebedVideoBundle::menu.html.twig' %}
            <div id="time_child"></div>
        {% endblock %}

        <div class="container">
            <div class="row">

                <div class="col-sm-8 blog-main">
                    {% block content %}
                    {% endblock %}
                </div><!-- /.blog-main -->

                {% block rightsidebar %}
                    {% include 'LebedVideoBundle::rightsidebar.html.twig' %}
                {% endblock %}

            </div><!-- /.row -->

            <a id="time_child_fancybox" href="#popup"></a>

            <div style="display: none">
                <div id="popup">
                    You time is left!!!

                    Input you password:
                    <form id="profile_form" action="{{ url("lebed_child_check_pass") }}" method="post">
                        <input type="password" name="user_password" value=" " />
                        <button type="submit" value="submit">Send</button>
                    </form>
                </div>
            </div>
        </div><!-- /.container -->

        {% block footer %}
            {% include 'LebedVideoBundle::footer.html.twig' %}
        {% endblock %}

    {% endblock %}

    {% block jsAfterBody %}
        {#<script type="text/javascript" src="{{ asset('js/jquery.js') }}"></script>#}
        {#<script type="text/javascript" src="{{ asset('js/bootstrap.js') }}"></script>#}
        {{ parent() }}
        <script src="/js/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
        <script type="text/javascript">

            {% if is_granted('IS_AUTHENTICATED_FULLY') %}

            jQuery(document).ready(function(){




                {% if app.session.get('child') and app.session.get('time') %}
                var timer = {{ app.session.get('time') }};
                var time_setup = new Date('{{ app.session.get('time_setup') }}');

                var expiry = new Date(time_setup.setMinutes(time_setup.getMinutes() + timer));
                var current = new Date();

                var timetogo = (expiry-current)*0.001;
                var timer = window.setInterval(function()
                {
                    var str = timetogo;
                    jQuery('#time_child').text(str);


                    if (timetogo <= 0)
                    {
                        jQuery('#time_child').text('Время вышло');
                        console.log('time is left');

                        jQuery("#time_child_fancybox").fancybox({
                            'transitionIn'	:	'elastic',
                            'transitionOut'	:	'elastic',
                            'speedIn'		:	600,
                            'speedOut'		:	200,
                            'hideOnOverlayClick':false,
                            'hideOnContentClick':false,
                            'overlayShow'	:	false,
                            'closeClick'  : false, // prevents closing when clicking INSIDE fancybox
                            'openEffect'  : 'none',
                            'closeEffect' : 'none',
                            'helpers'   : {
                                overlay : {closeClick: false} // prevents closing when clicking OUTSIDE fancybox
                            }
                        }).trigger("click");
                        jQuery(".fancybox-close").css("display",'none');
                        window.clearInterval(timer);
                    }
                    timetogo--;
                }, 1000);

                {% endif %}
            });

            {% endif %}

        </script>
    {% endblock %}